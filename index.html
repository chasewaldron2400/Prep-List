<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prep List</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    .item-group {
      margin-bottom: 15px;
    }
    .hidden {
      display: none;
    }
    .station-buttons button {
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <h1>Inventory Prep List</h1>

  <div class="station-buttons">
    <button data-station-id="1">Saute</button>
    <button data-station-id="2">Grill</button>
    <button data-station-id="3">Cold</button>
  </div>

  <form id="prep-form" class="hidden">
    <h2 id="station-title"></h2>
    <div id="items-container"></div>
    <button type="submit">Submit Counts</button>
  </form>

  <div id="prep-results" class="hidden">
    <h2>Items Needed</h2>
    <ul id="results-list"></ul>
  </div>

  <script>
    const prepForm = document.getElementById("prep-form");
    const itemsContainer = document.getElementById("items-container");
    const resultsContainer = document.getElementById("prep-results");
    const resultsList = document.getElementById("results-list");
    const stationTitle = document.getElementById("station-title");

    let items = [];

    document.querySelectorAll(".station-buttons button").forEach(button => {
      button.addEventListener("click", async () => {
        const stationId = button.getAttribute("data-station-id");
        const stationName = button.textContent;

        // Reset UI
        prepForm.classList.remove("hidden");
        resultsContainer.classList.add("hidden");
        itemsContainer.innerHTML = "";
        stationTitle.textContent = `${stationName} Station`;

        // Fetch items for selected station
        const res = await fetch(`http://localhost:3001/items/${stationId}`);
        items = await res.json();

        // Render form
        items.forEach(item => {
          const div = document.createElement("div");
          div.className = "item-group";
          div.innerHTML = `
            <label>${item.name} (Par: ${item.par_quantity}, ${item.unit}, Location: ${item.location_name}):</label>
            <input type="number" min="0" name="${item.id}" data-par="${item.par_quantity}" data-location="${item.location_name}" required>
          `;
          itemsContainer.appendChild(div);
        });
      });
    });

    prepForm.addEventListener("submit", event => {
      event.preventDefault();

      const inputs = prepForm.querySelectorAll("input[type='number']");
      resultsList.innerHTML = "";

      inputs.forEach(input => {
        const current = parseInt(input.value, 10);
        const par = parseInt(input.dataset.par);
        const location = input.dataset.location;
        const item = items.find(i => i.id == input.name);

        const needed = par - current;

        if (needed > 0) {
          const li = document.createElement("li");
          li.textContent = `${needed}x ${item.unit} of ${item.name} needed from ${location}`;
          resultsList.appendChild(li);
        }
      });

      resultsContainer.classList.remove("hidden");
    });
  </script>

</body>
</html>
